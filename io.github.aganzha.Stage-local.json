{
   "app-id": "io.github.aganzha.Stage",
   "runtime": "org.gnome.Platform",
   "runtime-version": "49",
   "sdk": "org.gnome.Sdk",
   "sdk-extensions": [
      "org.freedesktop.Sdk.Extension.rust-stable"
   ],
   "command": "stage",
   "finish-args": [
      "--filesystem=home",
      "--share=ipc",
      "--share=network",
      "--socket=fallback-x11",
      "--socket=wayland",
      "--socket=ssh-auth",
      "--socket=gpg-agent",
      "--device=dri"
   ],
   "build-options": {
      "append-path": "/usr/lib/sdk/rust-stable/bin"
   },
    "build-options": {
        "append-path": "/usr/lib/sdk/rust-stable/bin",
        "env": {
            "CARGO_HOME": "/app/cargo",
            "RUST_BACKTRACE": "1",
            "RUST_LOG": "debug",
            "RUSTFLAGS":"-A deprecated",
            "OUT_DIR": "."
        }
    },
    "modules": [
        {
            "name": "setup-cargo",
            "buildsystem": "simple",
            "build-commands": [
                "mkdir -p /app/cargo",
                "echo '[source.crates-io]' > /app/cargo/config.toml",
                "echo 'replace-with = \"vendored-sources\"' >> /app/cargo/config.toml",
                "echo '[source.vendored-sources]' >> /app/cargo/config.toml",
                "echo 'directory = \"/app/cargo/registry/vendor\"' >> /app/cargo/config.toml"
            ]
        },
        {
            "name": "vendor-deps",
            "buildsystem": "simple",
            "build-commands": [
                "mkdir -p /app/cargo/registry",
                "cp -r vendor /app/cargo/registry/vendor"
            ],
            "sources": [
                {
                    "type": "dir",
                    "path": "vendor",
                    "dest": "vendor"
                }
            ]
        },
        {
            "name": "stage",
            "buildsystem": "simple",
            "build-commands": [
                "glib-compile-resources ./io.github.aganzha.Stage.gresource.xml --target ./gresources.compiled",
                "cargo build --release --locked --offline --target-dir=target",
                "install -Dm755 target/release/stage /app/bin/stage",
                "glib-compile-schemas . && cp ./gschemas.compiled target/release",
                "install -Dm744 target/release/gschemas.compiled -t /app/bin/",
                "install -Dm644 io.github.aganzha.Stage.metainfo.xml -t /app/share/metainfo",
                "install -Dm644 io.github.aganzha.Stage.desktop -t /app/share/applications",
                "install -Dm644 icons/16x16/io.github.aganzha.Stage.png -t /app/share/icons/hicolor/16x16/apps",
                "install -Dm644 icons/32x32/io.github.aganzha.Stage.png -t /app/share/icons/hicolor/32x32/apps",
                "install -Dm644 icons/48x48/io.github.aganzha.Stage.png -t /app/share/icons/hicolor/48x48/apps",
                "install -Dm644 icons/64x64/io.github.aganzha.Stage.png -t /app/share/icons/hicolor/64x64/apps",
                "install -Dm644 icons/128x128/io.github.aganzha.Stage.png -t /app/share/icons/hicolor/128x128/apps",
                "install -Dm644 icons/256x256/io.github.aganzha.Stage.png -t /app/share/icons/hicolor/256x256/apps",
                "install -Dm644 icons/512x512/io.github.aganzha.Stage.png -t /app/share/icons/hicolor/512x512/apps",
                "install -Dm644 icons/io.github.aganzha.Stage.svg -t /app/share/icons/hicolor/scalable/apps",
                "install -Dm644 icons/io.github.aganzha.Stage-symbolic.svg -t /app/share/icons/hicolor/symbolic/apps",
                "install -Dm644 icons/org.gnome.Logs-symbolic.svg -t /app/share/icons/hicolor/symbolic/apps"
            ],
            "sources": [
                {
                    "type": "dir",
                    "path": "."
                }
            ]
        }
    ]
}
