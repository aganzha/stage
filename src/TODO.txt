THINK: is it a good idea, that each module (e.g. git::merge) whil contain its own implementation of methods
required by this module? 
BUG: panic
[INFO  stage] Staged
thread '<unnamed>' panicked at src/git/remote.rs:317:38:
called `Result::unwrap()` on an `Err` value: Error { code: -3, klass: 7, message: "config value 'branch.provoke_conflict.remote' was not found" }
stack backtrace:
[INFO  stage] Unstaged
[INFO  stage] main. untracked
   0: rust_begin_unwind

+++++++++++++++++++++
for the merge bug. store conflict hunk size for current repo in gsettings. when conflicts are removed
- cleanup that settings. i've stored something allready per repo!
++++++++++++++++++++++++++++++
TODO: all that must just go to private cloud, must be buildable on command. means flatpack build.
and then on client machine it must be easily updated with flatpak update. no any flatpak builders
are required. just own repo. it need to try install flatpak from remote!
so. plan. make private remote server. in container? try install flatpack inside container! and build there.
and install from that remote cloud container!
--------------------------
so, create container with https://github.com/flatpak/flat-manager
usually, it must be local server running it. it could be run locally in container.
but for public it must be run with lambda, of course.
==========================
it need to start with local builds as local server. how to save data between lambdas calls?
it uses postgres. postgres data must be stored somewhere. permamently between lambda calls.


BUG: cursor does not work sometimes on first click. thats why i killed whole file, while trying to kill just first hunk
BUG: open old_docs. expand all hunks. switch to spare_docs - garbage in textview
BUG: stage 1 file from list of files when this file is expanded. cursor become wide as several rows
BUG: SPACES are important in diff! crytical
BUG: infinite loop in new reconciliation
******************************** from scratch ******************************
BUG: open branches. open log. hard reset from log. close. the branch data in branch list is not changed!
BUG: when doing any git op with result? error returned to branch, but it need also to update remo status!
to do that it need to implement object with drop interface. and inside its drop it need to call get_current_repo_status!


repo has method open_rebase


TODO: disable all branch ops in branches view during rebase!

in the rebase there is a conflict: path dc4 already applied! but it is not applied, it was cherry picked and now have another sha!
think about it:
the name is "display detached head" dc4e681f0a16dd8faad8282fc670c8b2bb738b04 in follow rebase and 06aa1eeac8e20c8f2321ee590e7d6edf32900ff5 in rebase


perhaps the problem is - it is going to stage during conflict resolution!
*********************************************************************************

TODO: TextView::extra_menu - for search and for stage/unstage/kill.
TODO: implement search with ctrl-f, ctrl-s, f3
TODO: add margins to text view in commit form
BUG: maybe related: staged 2 hunks in dn_scanner. then kill in unstaged hank. then. maybe, expand. panic in result
BUG: Crytical: garbage in text. file is invisible! garbage hunks in the end of view and they are expandable!
TODO: allow ammend to change last commit message without changes
TODO: expand-collapse all
TODO: add toast to switching branch (in general - for branch actions)
TODO: squash
BUG: stage 1 file. expand 1 unstaged hunk and view hunk highlights. they are jumped!
TODO: show spaces in diffs!
BUG: create branch. change 2 files. commit. checkout main. cherry pick 1 file from that branch - stage view is not refreshed!
looks like something with monitors! well, it need to switch monitors when switch repo, of course

TODO: disable all branch ops in branches view during rebase!

in the rebase there is a conflict: path dc4 already applied! but it is not applied, it was cherry picked and now have another sha!
think about it:
the name is "display detached head" dc4e681f0a16dd8faad8282fc670c8b2bb738b04 in follow rebase and 06aa1eeac8e20c8f2321ee590e7d6edf32900ff5 in rebase

remote is apeared (new branch) below head and cursor shifted down, but hightlight was on same line

TODO: when something panic in main thread, the next thing is panic at cant sent through channel.
perhaps recover from it?
TODO: when user is trying to stage in unstaged, show him commit confirm message!

cursor is staying on same line and its highlighted.
but content behind it changed. at this moment it need to tap cursor?
yes, thats what i did before!

TODO: attach this to errors, or rather just print to log! https://doc.rust-lang.org/std/backtrace/
TODO: rename dirty to transfered. no more dirty :)
BUG: expand does not work on first line!
BUG: expand - moves to the start.
BUG: higjlight 2 regions when set on the hunk line (from bottom)
Rc::clone() instead of .clone()

and some new lines to check, what?
- пустое представление!
- implement about popup with github issue
- stage and revert hunks and files from any commit_view
go with amend
TODO: passing window in internal list methods, but window could be obtained by root inside those methods!

TODO: rename _view.rs to _list.rs
views must be connected with each other with large linked list. list across all view
global array of text tag in buffer. each view stores indexes of self tags froms this array!
[tag, tag, tag, tag]
[0    1    0    1

BUG: after merge head is not updated! (found after push)

if remove vector fron view it could be Copy type and then it could be wrapped
in Cell and then i will not need &mut self everywhere, cause view will be by passed by &self!!!


TODO: when there is nothing to stage - open commit edit message dialog!

one

BUG: in docs. commit starting with abab does not expand last line!
6d978 - interesting commit


BUG: refresh branches must react to user login! what about pull? connect it to push/pull from branches view!
TODO: ammend!
BUG: monitors sometimes are off, when switch to other repo
BUG: panic when apply stage: thread '<unnamed>' panicked at src/git.rs:1039:10:
cant apply stash: Error { code: -22, klass: 19, message: "4 uncommitted changes exist in the index" }

loice

TODO: measure line length for each line under cursor is not effective. perhaps introduce one
more flag to view and during resize event reset those flags to perform buildup?
TODO: in branch list please show remote status somehow
BUG: conflict with file deletion. there are no our conflict!
      
when swicth repo and stashes is open - they still show stashes from previous repo


thread '<unnamed>' panicked at src/git.rs:560:32:
called `Option::unwrap()` on a `None` value
!!!!!!!(deleted by us)




BUG: when kill untracked file from magit (when it was visible in stage), it remains visible and even changing repo does not help
# pull branch whithout remote

TODO: Cherry-pick - it does copy changes but does not create commit (feature?) refresh button does not cleanu state
      feature - add popup while click on state suggest cleanup. 
      
thread '<unnamed>' panicked at src/git.rs:585:21:
not yet implemented: provoke conflict


[DEBUG stage::git] push status Some("pre-receive hook declined")
       thread '<unnamed>' panicked at src/git.rs:1009:13:
       assertion failed: opt_status.is_none()
       stack backtrace:

TODO: mnemonic!
BUG: after manipulating branches stashes list is empty, and just feeling of stashes in the log
     dot emacs file also apeared in unstaged, and killing it causeing panic
     
BUG: thread '<unnamed>' panicked at src/git.rs:149:9:
     cant reverse header @@ -1 +0,0 @@
BUG: thread 'main' panicked at src/status_view/container.rs:199:14:
     can't get iter at line
     stack backtrace:

     
thread '<unnamed>' panicked at src/git.rs:1114:14:
can't get commit from ref!: thats a conflict

BUG: kill in untracked stages it + what if it is a directory???
BUG: unstaging 1 untracked unstage all untracked (perhaps in libgit)

two

so, about search - the head is does not matter. what matter is selected position.
it need to update list in such a way, that selected position is always visible
PERFORMANCE: delete ~/docs/client/WHDDemo and open app :)
Perhaps it need to put path to status. and window to context!!!!

BUG: state Revert was cleared, but refresh btn does not reflect that
thats mine conflict 2
BUG: do not know how to reproduse: after creating branch staging was not working cause ApplyFilter was empty!
BUG: during merge do not create final commit. all changes will be in staged and state will be merge.
     reset --hard from console and then refresh - there is a garbage string on the place of State
     
BUG: checkout remote branch. then checkout remote branch again!
thread '<unnamed>' panicked at src/git.rs:1043:18:
cant create branch: Error { code: -4, klass: 4, message: "failed to write reference 'refs/heads/rc-24.1204': a reference with that name already exists." }


TODO: commit ammend after post push hook
TODO: while branch list is loaded it need to show empty repr
FEATURE: add expand rows to hunks as in gitlab!
make it in HUNK row! expand before and expand after!
TODO: [TRACE stage::git] push_update_reference "refs/heads/24.2100/bugfix/au.ganzha/prevent_tobacco" Some("pre-receive hook declined")
display hook here agai
------------------------
and resolve
TODO: display killed spaces please
/usr/bin/gtk4-launch org.gtk.WidgetFactory4
/usr/bin/gtk4-launch org.gnome.Tour
cat /usr/share/applications/org.gnome.Tour.desktop


ls -la /var/lib/flatpak/app/io.gitlab.liferooter.TextPieces/
ls -la /var/lib/flatpak/exports/share/applications/ | grep Text
lrwxrwxrwx. 1 root root  125 Jun 17 18:15 io.gitlab.liferooter.TextPieces.desktop -> ../../../app/io.gitlab.liferooter.TextPieces/current/active/export/share/applications/io.gitlab.liferooter.TextPieces.desktop

so
/home/aganzha/.local/share/flatpak/exports/share must repeat /var/lib/flatpak/exports/share

ls -la /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/
vs
/var/lib/flatpak/app/io.gitlab.liferooter.TextPieces/current/active/export/share/applications/io.gitlab.liferooter.TextPieces.desktop

ouh !!!!!!!!!!!!!
cat /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/bin/com.github.aganzha.stage 
#!/bin/sh
exec /usr/bin/flatpak run --branch=master --arch=x86_64 com.github.aganzha.stage "$@"

so:
 mkdir /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/applications
 cp ~/stage/com.github.aganzha.stage.desktop /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/applications/

icon: ls -la /var/lib/flatpak/app/io.gitlab.liferooter.TextPieces/current/active/export/share/icons/hicolor/symbolic/apps/
cat /var/lib/flatpak/app/io.gitlab.liferooter.TextPieces/current/active/export/share/metainfo/io.gitlab.liferooter.TextPieces.metainfo.xml

do:
 mkdir /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share

 mkdir /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share/applications

hm. looks the same:
aganzha@fedora:~/interpreter$ ls -la /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share/applications
total 4
drwxr-xr-x. 1 aganzha aganzha  64 Jun 23 20:19 .
drwxr-xr-x. 1 aganzha aganzha  24 Jun 23 20:18 ..
-rw-r--r--. 1 aganzha aganzha 475 Jun 23 20:19 com.github.aganzha.stage.desktop
aganzha@fedora:~/interpreter$ ls -la /var/lib/flatpak/app/io.gitlab.liferooter.TextPieces/current/active/export/share/applications/
total 4
drwxr-xr-x. 1 root root   78 Jun 17 18:15 .
drwxr-xr-x. 1 root root   50 Jan  1  1970 ..
-rwxr-xr-x. 1 root root 1105 Jun 17 18:15 io.gitlab.liferooter.TextPieces.desktop

perhaps needs reloading?
nope. restart does not work.
perhaps it requird xml.

aganzha@fedora:~/stage$ mkdir /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share/icons
aganzha@fedora:~/stage$ mkdir /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share/icons/hicolor
aganzha@fedora:~/stage$ mkdir /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share/icons/hicolor/symbolic
aganzha@fedora:~/stage$ mkdir /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share/icons/hicolor/symbolic/apps

mkdir /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share/icons/hicolor/scalable/
mkdir /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share/icons/hicolor/scalable/apps

cp logo.svg /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share/icons/hicolor/scalable/apps/
cp symbolic.svg /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share/icons/hicolor/symbolic/apps/com.github.aganzha.stage-symbolic.svg

cd /home/aganzha/.local/share/flatpak/exports/share/applications
ln -s /home/aganzha/.local/share/flatpak/app/com.github.aganzha.stage/current/active/export/share/applications/com.github.aganzha.stage.desktop


update-desktop-database --help
update-desktop-database /home/aganzha/.local/share/flatpak/exports/share
YES!
